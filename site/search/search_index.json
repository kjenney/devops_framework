{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DevOps Framework","text":"<p>A Python library and CLI for DevOps troubleshooting across AWS, EKS/Kubernetes, and Datadog.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>AWS \u2014 EC2, RDS, Lambda, and CloudWatch operations</li> <li>EKS \u2014 Pod, Deployment, and Service management via kubeconfig</li> <li>Datadog \u2014 Log search and metrics querying</li> <li>Unified CLI \u2014 <code>devops aws | eks | datadog</code> subcommands</li> <li>Consistent error handling \u2014 custom exception hierarchy wrapping all third-party errors</li> </ul>"},{"location":"#quick-install","title":"Quick Install","text":"<pre><code>pip install devops-framework\n</code></pre>"},{"location":"#minimal-example","title":"Minimal Example","text":"<pre><code>from devops_framework.aws.ec2 import EC2Client\n\nclient = EC2Client(region=\"us-east-1\")\ninstances = client.list_running_instances()\nfor inst in instances:\n    print(inst[\"InstanceId\"], inst[\"State\"][\"Name\"])\n</code></pre>"},{"location":"#cli-quick-start","title":"CLI Quick-Start","text":"<pre><code># List running EC2 instances\ndevops aws list-instances --region us-east-1 --running\n\n# Stream pod logs\ndevops eks get-pod-logs my-pod-abc123 --namespace production --tail 50\n\n# Query Datadog metrics for the last 2 hours\ndevops datadog query-metrics --query \"avg:system.cpu.user{*}\" --hours 2\n</code></pre>"},{"location":"#navigation","title":"Navigation","text":"Section Description Installation Set up a virtual environment and install the package Configuration Env vars, YAML config, and precedence rules CLI Reference All <code>devops</code> subcommands with options and examples API Reference Python client classes and methods Examples End-to-end scripts for common tasks"},{"location":"configuration/","title":"Configuration","text":"<p>The framework resolves configuration in this order of precedence (highest first):</p> <ol> <li>Environment variables</li> <li>YAML config file (<code>~/.devops-framework/config.yaml</code>)</li> <li>Built-in defaults</li> </ol>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":""},{"location":"configuration/#aws","title":"AWS","text":"Variable Config property Default Description <code>AWS_DEFAULT_REGION</code> or <code>AWS_REGION</code> <code>aws_region</code> <code>us-east-1</code> AWS region <code>AWS_PROFILE</code> <code>aws_profile</code> None Named AWS credentials profile <code>AWS_ROLE_ARN</code> <code>aws_role_arn</code> None IAM role to assume <p>Standard boto3 credential vars (<code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, <code>AWS_SESSION_TOKEN</code>) are also supported and resolved by boto3 automatically.</p>"},{"location":"configuration/#eks-kubernetes","title":"EKS / Kubernetes","text":"Variable Config property Default Description <code>KUBECONFIG</code> <code>eks_kubeconfig</code> None Path to kubeconfig file <code>KUBE_CONTEXT</code> <code>eks_context</code> None Kubeconfig context to use <code>KUBE_NAMESPACE</code> <code>eks_namespace</code> <code>default</code> Default Kubernetes namespace"},{"location":"configuration/#datadog","title":"Datadog","text":"Variable Config property Default Description <code>DD_API_KEY</code> <code>datadog_api_key</code> required Datadog API key <code>DD_APP_KEY</code> <code>datadog_app_key</code> required Datadog application key <code>DD_SITE</code> <code>datadog_site</code> <code>datadoghq.com</code> Datadog site (e.g. <code>datadoghq.eu</code>)"},{"location":"configuration/#yaml-config-file","title":"YAML Config File","text":"<p>Place a YAML file at <code>~/.devops-framework/config.yaml</code>:</p> <pre><code>aws:\n  region: us-west-2\n  profile: my-aws-profile\n  # role_arn: arn:aws:iam::123456789012:role/MyRole\n\neks:\n  kubeconfig: /home/user/.kube/config\n  context: my-eks-cluster\n  namespace: production\n\ndatadog:\n  api_key: YOUR_DD_API_KEY\n  app_key: YOUR_DD_APP_KEY\n  site: datadoghq.com\n</code></pre> <p>Warning</p> <p>Avoid storing API keys in plain text. Prefer environment variables or a secrets manager.</p>"},{"location":"configuration/#using-the-config-object-directly","title":"Using the Config Object Directly","text":"<pre><code>from devops_framework.core.config import Config\n\ncfg = Config()\nprint(cfg.aws_region)       # e.g. \"us-west-2\"\nprint(cfg.eks_namespace)    # e.g. \"production\"\nprint(cfg.datadog_site)     # e.g. \"datadoghq.com\"\n\n# Raise ConfigurationError if a required key is missing\ncfg.require(\"datadog_api_key\", \"datadog_app_key\")\n</code></pre>"},{"location":"configuration/#custom-config-path","title":"Custom Config Path","text":"<p>All clients accept an optional <code>config</code> parameter:</p> <pre><code>from pathlib import Path\nfrom devops_framework.core.config import Config\nfrom devops_framework.aws.ec2 import EC2Client\n\ncfg = Config(config_path=Path(\"/etc/myapp/devops.yaml\"))\nclient = EC2Client(config=cfg)\n</code></pre>"},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.12+</li> <li>AWS credentials configured (for AWS commands)</li> <li>A valid kubeconfig (for EKS commands)</li> <li>Datadog API and application keys (for Datadog commands)</li> </ul>"},{"location":"installation/#install-from-source","title":"Install from Source","text":"<pre><code># Clone the repository\ngit clone https://github.com/example/devops-framework.git\ncd devops-framework\n\n# Create and activate a virtual environment\npython3 -m venv .venv\nsource .venv/bin/activate   # Windows: .venv\\Scripts\\activate\n\n# Install with development dependencies\npip install -e \".[dev]\"\n</code></pre>"},{"location":"installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install devops-framework\n</code></pre>"},{"location":"installation/#verify-the-installation","title":"Verify the Installation","text":"<pre><code>devops --help\n</code></pre> <p>Expected output:</p> <pre><code>Usage: devops [OPTIONS] COMMAND [ARGS]...\n\nOptions:\n  --help  Show this message and exit.\n\nCommands:\n  aws      AWS operations: EC2, RDS, Lambda, CloudWatch.\n  eks      EKS/Kubernetes operations: pods, deployments, services.\n  datadog  Datadog operations: logs and metrics.\n</code></pre>"},{"location":"installation/#running-tests","title":"Running Tests","text":"<pre><code># All tests with coverage\npytest\n\n# Fast (no coverage)\npytest --no-cov\n\n# Verbose\npytest -v\n</code></pre> <p>Or use the Makefile shortcuts:</p> <pre><code>make test\nmake test-fast\nmake test-verbose\n</code></pre>"},{"location":"api/aws/","title":"AWS API Reference","text":"<p>All AWS clients extend <code>AWSBaseClient</code>, which itself extends <code>IntegrationBaseClient</code>. Pass an optional <code>region</code> or <code>config</code> to any constructor.</p> <pre><code>from devops_framework.aws.ec2 import EC2Client\nfrom devops_framework.aws.rds import RDSClient\nfrom devops_framework.aws.lambda_ import LambdaClient\nfrom devops_framework.aws.cloudwatch import CloudWatchClient\n</code></pre>"},{"location":"api/aws/#ec2client","title":"EC2Client","text":"<pre><code>EC2Client(region: str | None = None, config: Config | None = None)\n</code></pre>"},{"location":"api/aws/#methods","title":"Methods","text":""},{"location":"api/aws/#list_instancesfiltersnone-instance_idsnone-listdict","title":"<code>list_instances(filters=None, instance_ids=None) -&gt; list[dict]</code>","text":"<p>Return a flat list of instance dicts (without reservation wrappers).</p> <pre><code>client = EC2Client(region=\"us-east-1\")\n\n# All instances\ninstances = client.list_instances()\n\n# Specific instances\ninstances = client.list_instances(instance_ids=[\"i-0abc123\", \"i-0def456\"])\n\n# With filters\ninstances = client.list_instances(\n    filters=[{\"Name\": \"instance-state-name\", \"Values\": [\"running\", \"stopped\"]}]\n)\n</code></pre>"},{"location":"api/aws/#get_instanceinstance_id-dict","title":"<code>get_instance(instance_id) -&gt; dict</code>","text":"<p>Return a single instance dict. Raises <code>ResourceNotFoundError</code> if not found.</p>"},{"location":"api/aws/#list_running_instances-listdict","title":"<code>list_running_instances() -&gt; list[dict]</code>","text":"<p>Shortcut for <code>list_instances</code> filtered to <code>instance-state-name = running</code>.</p>"},{"location":"api/aws/#get_instance_statusinstance_id-dict","title":"<code>get_instance_status(instance_id) -&gt; dict</code>","text":"<p>Return instance and system status checks for a single instance.</p>"},{"location":"api/aws/#stop_instanceinstance_id-dict","title":"<code>stop_instance(instance_id) -&gt; dict</code>","text":"<p>Stop an EC2 instance. Returns the <code>StoppingInstances[0]</code> response dict.</p>"},{"location":"api/aws/#start_instanceinstance_id-dict","title":"<code>start_instance(instance_id) -&gt; dict</code>","text":"<p>Start an EC2 instance. Returns the <code>StartingInstances[0]</code> response dict.</p>"},{"location":"api/aws/#rdsclient","title":"RDSClient","text":"<pre><code>RDSClient(region: str | None = None, config: Config | None = None)\n</code></pre>"},{"location":"api/aws/#methods_1","title":"Methods","text":""},{"location":"api/aws/#list_instancesdb_instance_identifiernone-listdict","title":"<code>list_instances(db_instance_identifier=None) -&gt; list[dict]</code>","text":"<p>List RDS DB instances. Filter by identifier if provided.</p>"},{"location":"api/aws/#get_instancedb_instance_identifier-dict","title":"<code>get_instance(db_instance_identifier) -&gt; dict</code>","text":"<p>Return a single DB instance dict. Raises <code>ResourceNotFoundError</code> if not found.</p>"},{"location":"api/aws/#list_clustersdb_cluster_identifiernone-listdict","title":"<code>list_clusters(db_cluster_identifier=None) -&gt; list[dict]</code>","text":"<p>List Aurora DB clusters. Filter by identifier if provided.</p>"},{"location":"api/aws/#get_clusterdb_cluster_identifier-dict","title":"<code>get_cluster(db_cluster_identifier) -&gt; dict</code>","text":"<p>Return a single DB cluster dict. Raises <code>ResourceNotFoundError</code> if not found.</p>"},{"location":"api/aws/#get_instance_eventsdb_instance_identifier-duration1440-listdict","title":"<code>get_instance_events(db_instance_identifier, duration=1440) -&gt; list[dict]</code>","text":"<p>Return recent events for a DB instance. <code>duration</code> is in minutes (default 24 h).</p> <pre><code>client = RDSClient()\nevents = client.get_instance_events(\"mydb\", duration=60)  # last 1 hour\nfor event in events:\n    print(event[\"Message\"], event[\"Date\"])\n</code></pre>"},{"location":"api/aws/#lambdaclient","title":"LambdaClient","text":"<pre><code>LambdaClient(region: str | None = None, config: Config | None = None)\n</code></pre>"},{"location":"api/aws/#methods_2","title":"Methods","text":""},{"location":"api/aws/#list_functions-listdict","title":"<code>list_functions() -&gt; list[dict]</code>","text":"<p>Return all Lambda functions in the configured region (paginated).</p>"},{"location":"api/aws/#get_functionfunction_name-dict","title":"<code>get_function(function_name) -&gt; dict</code>","text":"<p>Return configuration and code location. Raises <code>ResourceNotFoundError</code> if the function does not exist.</p>"},{"location":"api/aws/#get_function_configurationfunction_name-dict","title":"<code>get_function_configuration(function_name) -&gt; dict</code>","text":"<p>Return only the configuration (no code location). Raises <code>ResourceNotFoundError</code> if not found.</p>"},{"location":"api/aws/#invokefunction_name-payloadnone-invocation_typerequestresponse-dict","title":"<code>invoke(function_name, payload=None, invocation_type=\"RequestResponse\") -&gt; dict</code>","text":"<p>Invoke a Lambda function synchronously and return parsed response.</p> <ul> <li><code>payload</code> \u2014 optional <code>dict</code> serialised to JSON before sending.</li> <li><code>invocation_type</code> \u2014 <code>\"RequestResponse\"</code> (sync) or <code>\"Event\"</code> (async).</li> <li>Raises <code>AWSAPIError</code> if the function returns a <code>FunctionError</code>.</li> </ul> <pre><code>client = LambdaClient(region=\"eu-west-1\")\nresult = client.invoke(\"my-function\", payload={\"key\": \"value\"})\nprint(result[\"StatusCode\"])   # 200\nprint(result[\"Payload\"])      # parsed response body\n</code></pre>"},{"location":"api/aws/#cloudwatchclient","title":"CloudWatchClient","text":"<pre><code>CloudWatchClient(region: str | None = None, config: Config | None = None)\n</code></pre>"},{"location":"api/aws/#metrics-methods","title":"Metrics Methods","text":""},{"location":"api/aws/#get_metric_statisticsnamespace-metric_name-dimensions-start_time-end_time-period300-statisticsnone-listdict","title":"<code>get_metric_statistics(namespace, metric_name, dimensions, start_time, end_time, period=300, statistics=None) -&gt; list[dict]</code>","text":"<p>Return sorted datapoints for a CloudWatch metric.</p> <ul> <li><code>period</code> \u2014 aggregation period in seconds (default 5 min).</li> <li><code>statistics</code> \u2014 list of <code>[\"Average\"]</code>, <code>[\"Sum\"]</code>, etc. Defaults to <code>[\"Average\"]</code>.</li> </ul> <pre><code>from datetime import datetime, timedelta, timezone\nfrom devops_framework.aws.cloudwatch import CloudWatchClient\n\nclient = CloudWatchClient()\nnow = datetime.now(timezone.utc)\npoints = client.get_metric_statistics(\n    namespace=\"AWS/EC2\",\n    metric_name=\"CPUUtilization\",\n    dimensions=[{\"Name\": \"InstanceId\", \"Value\": \"i-0abc123\"}],\n    start_time=now - timedelta(hours=1),\n    end_time=now,\n    period=300,\n    statistics=[\"Average\", \"Maximum\"],\n)\nfor p in points:\n    print(p[\"Timestamp\"], p[\"Average\"])\n</code></pre>"},{"location":"api/aws/#list_metricsnamespacenone-metric_namenone-listdict","title":"<code>list_metrics(namespace=None, metric_name=None) -&gt; list[dict]</code>","text":"<p>List CloudWatch metrics, optionally filtered by namespace and/or metric name.</p>"},{"location":"api/aws/#log-methods","title":"Log Methods","text":""},{"location":"api/aws/#list_log_groupsprefixnone-listdict","title":"<code>list_log_groups(prefix=None) -&gt; list[dict]</code>","text":"<p>List CloudWatch Log groups, optionally filtered by name prefix.</p>"},{"location":"api/aws/#get_log_eventslog_group_name-log_stream_name-start_timenone-end_timenone-limit100-listdict","title":"<code>get_log_events(log_group_name, log_stream_name, start_time=None, end_time=None, limit=100) -&gt; list[dict]</code>","text":"<p>Return events from a specific log stream. Raises <code>ResourceNotFoundError</code> if the stream does not exist.</p>"},{"location":"api/aws/#filter_log_eventslog_group_name-filter_pattern-start_timenone-end_timenone-limit100-listdict","title":"<code>filter_log_events(log_group_name, filter_pattern=\"\", start_time=None, end_time=None, limit=100) -&gt; list[dict]</code>","text":"<p>Search across all streams in a log group using a CloudWatch filter pattern.</p> <pre><code>events = client.filter_log_events(\n    log_group_name=\"/aws/lambda/my-function\",\n    filter_pattern=\"ERROR\",\n    limit=50,\n)\nfor e in events:\n    print(e[\"timestamp\"], e[\"message\"])\n</code></pre>"},{"location":"api/core/","title":"Core API Reference","text":"<p>The <code>devops_framework.core</code> package provides the shared foundation used by all integration clients.</p>"},{"location":"api/core/#config","title":"Config","text":"<pre><code>from devops_framework.core.config import Config\n</code></pre> <p>Unified configuration holder. Resolves settings from environment variables, a YAML file, or built-in defaults.</p>"},{"location":"api/core/#constructor","title":"Constructor","text":"<pre><code>Config(config_path: Path | None = None)\n</code></pre> <ul> <li><code>config_path</code> \u2014 override the default config path (<code>~/.devops-framework/config.yaml</code>).</li> </ul>"},{"location":"api/core/#properties","title":"Properties","text":"Property Type Description <code>aws_region</code> <code>str</code> AWS region (default: <code>us-east-1</code>) <code>aws_profile</code> <code>str \\| None</code> Named AWS credentials profile <code>aws_role_arn</code> <code>str \\| None</code> IAM role ARN to assume <code>eks_kubeconfig</code> <code>str \\| None</code> Path to kubeconfig file <code>eks_context</code> <code>str \\| None</code> Kubeconfig context name <code>eks_namespace</code> <code>str</code> Default Kubernetes namespace (default: <code>default</code>) <code>datadog_api_key</code> <code>str \\| None</code> Datadog API key <code>datadog_app_key</code> <code>str \\| None</code> Datadog application key <code>datadog_site</code> <code>str</code> Datadog site (default: <code>datadoghq.com</code>)"},{"location":"api/core/#methods","title":"Methods","text":""},{"location":"api/core/#requireattr_names","title":"<code>require(*attr_names)</code>","text":"<p>Raise <code>ConfigurationError</code> if any listed attribute is <code>None</code> or empty.</p> <pre><code>cfg = Config()\ncfg.require(\"datadog_api_key\", \"datadog_app_key\")\n</code></pre>"},{"location":"api/core/#integrationbaseclient","title":"IntegrationBaseClient","text":"<pre><code>from devops_framework.core.base import IntegrationBaseClient\n</code></pre> <p>Abstract base class for all integration clients. Provides a shared <code>Config</code> instance and a module-scoped logger.</p>"},{"location":"api/core/#constructor_1","title":"Constructor","text":"<pre><code>IntegrationBaseClient(config: Config | None = None)\n</code></pre> <p>A fresh <code>Config()</code> is created automatically if <code>config</code> is not supplied.</p>"},{"location":"api/core/#properties_1","title":"Properties","text":"Property Type Description <code>config</code> <code>Config</code> The resolved configuration object <code>logger</code> <code>logging.Logger</code> Logger scoped to the subclass module"},{"location":"api/core/#abstract-methods","title":"Abstract Methods","text":""},{"location":"api/core/#health_check-bool","title":"<code>health_check() -&gt; bool</code>","text":"<p>Must be implemented by each subclass. Return <code>True</code> if the integration is reachable and authenticated.</p>"},{"location":"api/core/#exception-hierarchy","title":"Exception Hierarchy","text":"<p>All exceptions inherit from <code>DevOpsFrameworkError</code>.</p> <pre><code>from devops_framework.core.exceptions import (\n    DevOpsFrameworkError,\n    AuthenticationError,\n    AWSAuthError,\n    DatadogAuthError,\n    EKSAuthError,\n    ResourceNotFoundError,\n    IntegrationAPIError,\n    AWSAPIError,\n    DatadogAPIError,\n    KubernetesAPIError,\n    ConfigurationError,\n)\n</code></pre> <pre><code>DevOpsFrameworkError\n\u251c\u2500\u2500 AuthenticationError\n\u2502   \u251c\u2500\u2500 AWSAuthError\n\u2502   \u251c\u2500\u2500 DatadogAuthError\n\u2502   \u2514\u2500\u2500 EKSAuthError\n\u251c\u2500\u2500 ResourceNotFoundError\n\u251c\u2500\u2500 IntegrationAPIError\n\u2502   \u251c\u2500\u2500 AWSAPIError\n\u2502   \u251c\u2500\u2500 DatadogAPIError\n\u2502   \u2514\u2500\u2500 KubernetesAPIError\n\u2514\u2500\u2500 ConfigurationError\n</code></pre>"},{"location":"api/core/#devopsframeworkerror","title":"DevOpsFrameworkError","text":"<p>Base exception. All framework errors carry a <code>message</code> string and optional <code>details</code> dict.</p> <pre><code>try:\n    ...\nexcept DevOpsFrameworkError as exc:\n    print(exc.message)\n    print(exc.details)\n</code></pre>"},{"location":"api/core/#resourcenotfounderror","title":"ResourceNotFoundError","text":"<p>Raised when a requested resource does not exist.</p> <pre><code>from devops_framework.core.exceptions import ResourceNotFoundError\n\ntry:\n    client.get_instance(\"i-nonexistent\")\nexcept ResourceNotFoundError as exc:\n    print(exc.resource_type)   # \"EC2 Instance\"\n    print(exc.identifier)      # \"i-nonexistent\"\n</code></pre>"},{"location":"api/core/#integrationapierror","title":"IntegrationAPIError","text":"<p>Raised when an API call fails. Includes an optional <code>status_code</code>.</p> <pre><code>except IntegrationAPIError as exc:\n    print(exc.status_code)\n</code></pre>"},{"location":"api/core/#configurationerror","title":"ConfigurationError","text":"<p>Raised when required configuration is missing or the YAML config cannot be parsed.</p>"},{"location":"api/datadog/","title":"Datadog API Reference","text":"<p>Datadog clients require <code>DD_API_KEY</code> and <code>DD_APP_KEY</code> environment variables (or equivalent YAML config). Both clients extend <code>DatadogBaseClient</code>.</p> <pre><code>from devops_framework.datadog.logs import LogsClient\nfrom devops_framework.datadog.metrics import MetricsClient\n</code></pre>"},{"location":"api/datadog/#logsclient","title":"LogsClient","text":"<pre><code>LogsClient(config: Config | None = None)\n</code></pre> <p>Wraps the Datadog Logs API v2.</p>"},{"location":"api/datadog/#methods","title":"Methods","text":""},{"location":"api/datadog/#search_logsquery-from_timenone-to_timenone-limit100-sort-timestamp-listdict","title":"<code>search_logs(query=\"*\", from_time=None, to_time=None, limit=100, sort=\"-timestamp\") -&gt; list[dict]</code>","text":"<p>Search Datadog logs and return a list of log event dicts.</p> <ul> <li><code>query</code> \u2014 Datadog log search query (default <code>\"*\"</code> matches all logs).</li> <li><code>from_time</code> / <code>to_time</code> \u2014 <code>datetime</code> objects (timezone-aware recommended). Default to the last hour if omitted.</li> <li><code>limit</code> \u2014 maximum number of results (default 100).</li> <li><code>sort</code> \u2014 <code>\"timestamp\"</code> (ascending) or <code>\"-timestamp\"</code> (descending, default).</li> </ul> <pre><code>from datetime import datetime, timedelta, timezone\nfrom devops_framework.datadog.logs import LogsClient\n\nclient = LogsClient()\nnow = datetime.now(timezone.utc)\n\nlogs = client.search_logs(\n    query=\"service:my-api status:error\",\n    from_time=now - timedelta(hours=4),\n    to_time=now,\n    limit=50,\n)\nfor log in logs:\n    attrs = log.get(\"attributes\", {})\n    print(attrs.get(\"timestamp\"), attrs.get(\"message\"))\n</code></pre>"},{"location":"api/datadog/#aggregate_logsquery-from_timenone-to_timenone-group_by_fieldsnone-listdict","title":"<code>aggregate_logs(query=\"*\", from_time=None, to_time=None, group_by_fields=None) -&gt; list[dict]</code>","text":"<p>Aggregate logs using the Datadog Logs Aggregate API. Returns a list of bucket dicts.</p> <ul> <li><code>group_by_fields</code> \u2014 list of facet names to group by (e.g. <code>[\"service\", \"status\"]</code>).</li> </ul> <pre><code>buckets = client.aggregate_logs(\n    query=\"service:my-api\",\n    from_time=now - timedelta(hours=1),\n    to_time=now,\n    group_by_fields=[\"status\"],\n)\nfor bucket in buckets:\n    print(bucket)\n</code></pre>"},{"location":"api/datadog/#metricsclient","title":"MetricsClient","text":"<pre><code>MetricsClient(config: Config | None = None)\n</code></pre> <p>Wraps the Datadog Metrics API v1.</p>"},{"location":"api/datadog/#methods_1","title":"Methods","text":""},{"location":"api/datadog/#query_metricsquery-from_timenone-to_timenone-dict","title":"<code>query_metrics(query, from_time=None, to_time=None) -&gt; dict</code>","text":"<p>Query a Datadog metrics expression. Returns the raw API response dict (including <code>series</code>).</p> <ul> <li><code>query</code> \u2014 Datadog metrics query string (e.g. <code>\"avg:system.cpu.user{*}\"</code>).</li> <li><code>from_time</code> / <code>to_time</code> \u2014 <code>datetime</code> objects. Default to the last 1 hour.</li> </ul> <pre><code>from devops_framework.datadog.metrics import MetricsClient\n\nclient = MetricsClient()\nresult = client.query_metrics(\n    query=\"avg:system.cpu.user{host:web-01}\",\n    from_time=now - timedelta(hours=1),\n    to_time=now,\n)\nfor series in result.get(\"series\", []):\n    print(series[\"metric\"], series[\"scope\"])\n    for ts, val in series.get(\"pointlist\", []):\n        print(f\"  {ts}: {val:.2f}\")\n</code></pre>"},{"location":"api/datadog/#list_active_metricsfrom_timenone-hostnone-liststr","title":"<code>list_active_metrics(from_time=None, host=None) -&gt; list[str]</code>","text":"<p>Return a list of actively reporting metric names.</p> <ul> <li><code>from_time</code> \u2014 look-back start time (default 24 hours ago).</li> <li><code>host</code> \u2014 filter by reporting host.</li> </ul> <pre><code>metrics = client.list_active_metrics(host=\"web-01\")\nprint(metrics[:10])\n</code></pre>"},{"location":"api/datadog/#get_metric_metadatametric_name-dict","title":"<code>get_metric_metadata(metric_name) -&gt; dict</code>","text":"<p>Return metadata (unit, description, type, etc.) for a specific metric.</p> <pre><code>meta = client.get_metric_metadata(\"system.cpu.user\")\nprint(meta.get(\"unit\"), meta.get(\"description\"))\n</code></pre>"},{"location":"api/eks/","title":"EKS API Reference","text":"<p>EKS clients authenticate via kubeconfig (file path from <code>KUBECONFIG</code> env var or config YAML). All three clients extend <code>EKSBaseClient</code>.</p> <pre><code>from devops_framework.eks.pods import PodClient\nfrom devops_framework.eks.deployments import DeploymentClient\nfrom devops_framework.eks.services import ServiceClient\n</code></pre>"},{"location":"api/eks/#podclient","title":"PodClient","text":"<pre><code>PodClient(namespace: str = \"default\", config: Config | None = None)\n</code></pre>"},{"location":"api/eks/#methods","title":"Methods","text":""},{"location":"api/eks/#list_podsnamespacenone-label_selectornone-listv1pod","title":"<code>list_pods(namespace=None, label_selector=None) -&gt; list[V1Pod]</code>","text":"<p>List pods. Uses the client's default namespace if <code>namespace</code> is omitted.</p> <pre><code>client = PodClient(namespace=\"production\")\n\n# All pods in namespace\npods = client.list_pods()\n\n# Filter by label\npods = client.list_pods(label_selector=\"app=my-service,env=prod\")\n</code></pre>"},{"location":"api/eks/#get_podpod_name-namespacenone-v1pod","title":"<code>get_pod(pod_name, namespace=None) -&gt; V1Pod</code>","text":"<p>Return a single pod object. Raises <code>ResourceNotFoundError</code> (HTTP 404) if not found.</p>"},{"location":"api/eks/#get_pod_logspod_name-namespacenone-containernone-tail_lines100-previousfalse-str","title":"<code>get_pod_logs(pod_name, namespace=None, container=None, tail_lines=100, previous=False) -&gt; str</code>","text":"<p>Return log output from a pod container as a string.</p> <ul> <li><code>container</code> \u2014 specify a container name in multi-container pods.</li> <li><code>tail_lines</code> \u2014 number of lines from the end of the log.</li> <li><code>previous</code> \u2014 retrieve logs from the previous (crashed) container instance.</li> </ul> <pre><code>logs = client.get_pod_logs(\n    \"my-pod-abc123\",\n    container=\"app\",\n    tail_lines=200,\n    previous=True,\n)\nprint(logs)\n</code></pre>"},{"location":"api/eks/#delete_podpod_name-namespacenone-none","title":"<code>delete_pod(pod_name, namespace=None) -&gt; None</code>","text":"<p>Delete a pod. If the pod is managed by a controller (Deployment, ReplicaSet, etc.), it will be recreated automatically.</p>"},{"location":"api/eks/#deploymentclient","title":"DeploymentClient","text":"<pre><code>DeploymentClient(namespace: str = \"default\", config: Config | None = None)\n</code></pre>"},{"location":"api/eks/#methods_1","title":"Methods","text":""},{"location":"api/eks/#list_deploymentsnamespacenone-label_selectornone-listv1deployment","title":"<code>list_deployments(namespace=None, label_selector=None) -&gt; list[V1Deployment]</code>","text":"<p>List deployments in the given namespace.</p>"},{"location":"api/eks/#get_deploymentdeployment_name-namespacenone-v1deployment","title":"<code>get_deployment(deployment_name, namespace=None) -&gt; V1Deployment</code>","text":"<p>Return a single deployment. Raises <code>ResourceNotFoundError</code> if not found.</p>"},{"location":"api/eks/#scale_deploymentdeployment_name-replicas-namespacenone-v1deployment","title":"<code>scale_deployment(deployment_name, replicas, namespace=None) -&gt; V1Deployment</code>","text":"<p>Patch the deployment's replica count. Returns the updated <code>V1Deployment</code> object.</p> <pre><code>client = DeploymentClient(namespace=\"production\")\nclient.scale_deployment(\"my-api\", replicas=5)\n</code></pre>"},{"location":"api/eks/#restart_deploymentdeployment_name-namespacenone-v1deployment","title":"<code>restart_deployment(deployment_name, namespace=None) -&gt; V1Deployment</code>","text":"<p>Trigger a rolling restart by patching the pod template annotation <code>kubectl.kubernetes.io/restartedAt</code>. Equivalent to <code>kubectl rollout restart deployment/&lt;name&gt;</code>.</p> <pre><code>client.restart_deployment(\"my-api\")\n</code></pre>"},{"location":"api/eks/#serviceclient","title":"ServiceClient","text":"<pre><code>ServiceClient(namespace: str = \"default\", config: Config | None = None)\n</code></pre>"},{"location":"api/eks/#methods_2","title":"Methods","text":""},{"location":"api/eks/#list_servicesnamespacenone-label_selectornone-listv1service","title":"<code>list_services(namespace=None, label_selector=None) -&gt; list[V1Service]</code>","text":"<p>List services in the given namespace.</p>"},{"location":"api/eks/#get_serviceservice_name-namespacenone-v1service","title":"<code>get_service(service_name, namespace=None) -&gt; V1Service</code>","text":"<p>Return a single service. Raises <code>ResourceNotFoundError</code> if not found.</p>"},{"location":"api/eks/#get_endpointsservice_name-namespacenone-v1endpoints","title":"<code>get_endpoints(service_name, namespace=None) -&gt; V1Endpoints</code>","text":"<p>Return the <code>Endpoints</code> object for a service. Useful for checking which pod IPs back a service.</p> <pre><code>client = ServiceClient(namespace=\"production\")\nep = client.get_endpoints(\"my-api\")\nfor subset in ep.subsets or []:\n    for addr in subset.addresses or []:\n        print(addr.ip, addr.target_ref.name)\n</code></pre>"},{"location":"cli/aws/","title":"CLI Reference \u2014 AWS","text":"<pre><code>devops aws [COMMAND] [OPTIONS]\n</code></pre> <p>All AWS commands accept <code>--region</code> / <code>-r</code> to override the configured default region.</p>"},{"location":"cli/aws/#list-instances","title":"list-instances","text":"<p>List EC2 instances.</p> <pre><code>devops aws list-instances [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--region</code> <code>-r</code> text config default AWS region <code>--running</code> flag false Show only running instances <p>Examples</p> <pre><code># All instances in the default region\ndevops aws list-instances\n\n# Only running instances in us-west-2\ndevops aws list-instances --region us-west-2 --running\n</code></pre>"},{"location":"cli/aws/#describe-instance","title":"describe-instance","text":"<p>Show full details for a single EC2 instance as JSON.</p> <pre><code>devops aws describe-instance INSTANCE_ID [OPTIONS]\n</code></pre> Argument Description <code>INSTANCE_ID</code> EC2 instance ID (e.g. <code>i-0abc123def456</code>) Option Short Type Default Description <code>--region</code> <code>-r</code> text config default AWS region <p>Examples</p> <pre><code>devops aws describe-instance i-0abc123def456\ndevops aws describe-instance i-0abc123def456 --region eu-west-1\n</code></pre>"},{"location":"cli/aws/#list-db-instances","title":"list-db-instances","text":"<p>List RDS DB instances.</p> <pre><code>devops aws list-db-instances [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--region</code> <code>-r</code> text config default AWS region <p>Examples</p> <pre><code>devops aws list-db-instances\ndevops aws list-db-instances --region ap-southeast-1\n</code></pre>"},{"location":"cli/aws/#list-functions","title":"list-functions","text":"<p>List Lambda functions.</p> <pre><code>devops aws list-functions [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--region</code> <code>-r</code> text config default AWS region <p>Examples</p> <pre><code>devops aws list-functions\ndevops aws list-functions --region us-east-1\n</code></pre>"},{"location":"cli/aws/#invoke-function","title":"invoke-function","text":"<p>Invoke a Lambda function synchronously and print the response as JSON.</p> <pre><code>devops aws invoke-function FUNCTION_NAME [OPTIONS]\n</code></pre> Argument Description <code>FUNCTION_NAME</code> Lambda function name or ARN Option Short Type Default Description <code>--region</code> <code>-r</code> text config default AWS region <code>--payload</code> text None JSON payload string <p>Examples</p> <pre><code># Invoke without payload\ndevops aws invoke-function my-function\n\n# Invoke with a JSON payload\ndevops aws invoke-function my-function --payload '{\"key\":\"value\"}'\n\n# Invoke cross-region\ndevops aws invoke-function my-function --region eu-central-1 --payload '{}'\n</code></pre>"},{"location":"cli/aws/#list-log-groups","title":"list-log-groups","text":"<p>List CloudWatch Log groups.</p> <pre><code>devops aws list-log-groups [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--region</code> <code>-r</code> text config default AWS region <code>--prefix</code> text None Filter by log group name prefix <p>Examples</p> <pre><code>devops aws list-log-groups\ndevops aws list-log-groups --prefix /aws/lambda/\ndevops aws list-log-groups --region us-west-2 --prefix /ecs/\n</code></pre>"},{"location":"cli/datadog/","title":"CLI Reference \u2014 Datadog","text":"<pre><code>devops datadog [COMMAND] [OPTIONS]\n</code></pre> <p>Datadog commands require <code>DD_API_KEY</code> and <code>DD_APP_KEY</code> environment variables (or equivalent config).</p>"},{"location":"cli/datadog/#query-metrics","title":"query-metrics","text":"<p>Query Datadog metrics and display a summary table.</p> <pre><code>devops datadog query-metrics [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--query</code> <code>-q</code> text required Datadog metrics query <code>--hours</code> integer <code>1</code> Time window in hours <p>Examples</p> <pre><code># CPU utilization across all hosts for the last hour\ndevops datadog query-metrics --query \"avg:system.cpu.user{*}\"\n\n# Memory usage on a specific host for the last 6 hours\ndevops datadog query-metrics --query \"avg:system.mem.used{host:web-01}\" --hours 6\n\n# Request rate for a specific service\ndevops datadog query-metrics --query \"sum:trace.web.request.hits{service:my-api}.as_rate()\" --hours 2\n</code></pre>"},{"location":"cli/datadog/#list-metrics","title":"list-metrics","text":"<p>List actively reporting Datadog metrics.</p> <pre><code>devops datadog list-metrics [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--host</code> text None Filter metrics by reporting host <code>--hours</code> integer <code>24</code> Look-back window in hours <p>Examples</p> <pre><code># All active metrics for the last 24 hours\ndevops datadog list-metrics\n\n# Metrics reported by a specific host\ndevops datadog list-metrics --host web-01\n\n# Metrics from the last hour\ndevops datadog list-metrics --hours 1\n</code></pre>"},{"location":"cli/datadog/#search-logs","title":"search-logs","text":"<p>Search Datadog logs and print matching entries.</p> <pre><code>devops datadog search-logs [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--query</code> <code>-q</code> text <code>*</code> Datadog log search query <code>--limit</code> integer <code>20</code> Maximum number of logs to return <code>--hours</code> integer <code>1</code> Time window in hours <p>Examples</p> <pre><code># All logs for the last hour (up to 20)\ndevops datadog search-logs\n\n# Error logs from a specific service\ndevops datadog search-logs --query \"service:my-api status:error\" --limit 50\n\n# Search the last 4 hours\ndevops datadog search-logs --query \"host:web-01 ERROR\" --hours 4 --limit 100\n</code></pre>"},{"location":"cli/eks/","title":"CLI Reference \u2014 EKS","text":"<pre><code>devops eks [COMMAND] [OPTIONS]\n</code></pre> <p>All EKS commands use the kubeconfig resolved from <code>KUBECONFIG</code> env var or <code>~/.devops-framework/config.yaml</code>. The default namespace is <code>default</code> unless overridden with <code>--namespace</code>.</p>"},{"location":"cli/eks/#list-pods","title":"list-pods","text":"<p>List pods in a namespace.</p> <pre><code>devops eks list-pods [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--namespace</code> <code>-n</code> text <code>default</code> Kubernetes namespace <code>--selector</code> <code>-l</code> text None Label selector (e.g. <code>app=my-api</code>) <p>Examples</p> <pre><code># Pods in the default namespace\ndevops eks list-pods\n\n# Pods in a specific namespace\ndevops eks list-pods --namespace production\n\n# Filter by label\ndevops eks list-pods --namespace production --selector app=my-api,env=prod\n</code></pre>"},{"location":"cli/eks/#get-pod-logs","title":"get-pod-logs","text":"<p>Stream logs from a pod container.</p> <pre><code>devops eks get-pod-logs POD_NAME [OPTIONS]\n</code></pre> Argument Description <code>POD_NAME</code> Name of the pod Option Short Type Default Description <code>--namespace</code> <code>-n</code> text <code>default</code> Kubernetes namespace <code>--container</code> <code>-c</code> text None Container name (multi-container pods) <code>--tail</code> integer <code>100</code> Number of log lines to show <code>--previous</code> flag false Show logs from the previous crashed container <p>Examples</p> <pre><code># Last 100 lines from a pod\ndevops eks get-pod-logs my-pod-abc123\n\n# Last 200 lines from a specific container\ndevops eks get-pod-logs my-pod-abc123 --namespace production --container app --tail 200\n\n# Logs from the previous (crashed) container instance\ndevops eks get-pod-logs my-pod-abc123 --previous\n</code></pre>"},{"location":"cli/eks/#list-deployments","title":"list-deployments","text":"<p>List deployments in a namespace.</p> <pre><code>devops eks list-deployments [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--namespace</code> <code>-n</code> text <code>default</code> Kubernetes namespace <p>Examples</p> <pre><code>devops eks list-deployments\ndevops eks list-deployments --namespace staging\n</code></pre>"},{"location":"cli/eks/#scale-deployment","title":"scale-deployment","text":"<p>Scale a deployment to the specified replica count.</p> <pre><code>devops eks scale-deployment DEPLOYMENT_NAME REPLICAS [OPTIONS]\n</code></pre> Argument Description <code>DEPLOYMENT_NAME</code> Name of the deployment <code>REPLICAS</code> Desired replica count Option Short Type Default Description <code>--namespace</code> <code>-n</code> text <code>default</code> Kubernetes namespace <p>Examples</p> <pre><code># Scale to 5 replicas in the default namespace\ndevops eks scale-deployment my-api 5\n\n# Scale down to 0 (stop all pods)\ndevops eks scale-deployment my-api 0 --namespace production\n\n# Scale up\ndevops eks scale-deployment my-api 10 --namespace production\n</code></pre>"},{"location":"cli/eks/#list-services","title":"list-services","text":"<p>List services in a namespace.</p> <pre><code>devops eks list-services [OPTIONS]\n</code></pre> Option Short Type Default Description <code>--namespace</code> <code>-n</code> text <code>default</code> Kubernetes namespace <p>Examples</p> <pre><code>devops eks list-services\ndevops eks list-services --namespace production\n</code></pre>"},{"location":"examples/manage-deployments/","title":"Example: Manage Kubernetes Deployments","text":"<p>This example covers inspecting pods, streaming logs, scaling deployments, and triggering rolling restarts.</p>"},{"location":"examples/manage-deployments/#prerequisites","title":"Prerequisites","text":"<ul> <li>A valid kubeconfig file (e.g. <code>~/.kube/config</code> or pointed to by <code>KUBECONFIG</code>)</li> <li>Cluster access for the target namespace</li> </ul>"},{"location":"examples/manage-deployments/#scenario","title":"Scenario","text":"<p>Your <code>production</code> namespace has a service called <code>my-api</code>. You need to:</p> <ol> <li>Check pod health</li> <li>Stream logs from a failing pod</li> <li>Scale the deployment</li> <li>Trigger a rolling restart</li> </ol>"},{"location":"examples/manage-deployments/#python-script","title":"Python Script","text":"<pre><code>\"\"\"manage_deployments.py \u2014 Inspect and manage a Kubernetes deployment.\"\"\"\n\nfrom devops_framework.eks.deployments import DeploymentClient\nfrom devops_framework.eks.pods import PodClient\nfrom devops_framework.core.exceptions import KubernetesAPIError, ResourceNotFoundError\n\nNAMESPACE = \"production\"\nDEPLOYMENT = \"my-api\"\n\n\ndef check_pods(pod_client: PodClient) -&gt; None:\n    \"\"\"Print pod health summary.\"\"\"\n    pods = pod_client.list_pods(label_selector=f\"app={DEPLOYMENT}\")\n    print(f\"\\nPods for {DEPLOYMENT} in {NAMESPACE}:\")\n    for pod in pods:\n        meta = pod.metadata\n        status = pod.status\n        containers = (status.container_statuses or []) if status else []\n        ready = sum(1 for c in containers if c.ready)\n        restarts = sum(c.restart_count for c in containers)\n        print(\n            f\"  {meta.name}  phase={status.phase}  \"\n            f\"ready={ready}/{len(containers)}  restarts={restarts}\"\n        )\n    return pods\n\n\ndef stream_logs_for_crashlooping(pod_client: PodClient, pods: list) -&gt; None:\n    \"\"\"Print the previous container logs for any pod with high restart count.\"\"\"\n    for pod in pods:\n        containers = (pod.status.container_statuses or []) if pod.status else []\n        restarts = sum(c.restart_count for c in containers)\n        if restarts &gt; 5:\n            print(f\"\\nLogs (previous) for {pod.metadata.name}:\")\n            try:\n                logs = pod_client.get_pod_logs(\n                    pod.metadata.name, tail_lines=50, previous=True\n                )\n                print(logs)\n            except ResourceNotFoundError:\n                print(\"  Pod not found (may have been deleted).\")\n\n\ndef main() -&gt; None:\n    pod_client = PodClient(namespace=NAMESPACE)\n    dep_client = DeploymentClient(namespace=NAMESPACE)\n\n    pods = check_pods(pod_client)\n    stream_logs_for_crashlooping(pod_client, pods)\n\n    # Scale up if fewer than 3 replicas are ready\n    dep = dep_client.get_deployment(DEPLOYMENT)\n    ready = dep.status.ready_replicas or 0 if dep.status else 0\n    if ready &lt; 3:\n        print(f\"\\nOnly {ready} replicas ready. Scaling {DEPLOYMENT} to 3...\")\n        dep_client.scale_deployment(DEPLOYMENT, replicas=3)\n\n    # Trigger a rolling restart\n    print(f\"\\nTriggering rolling restart of {DEPLOYMENT}...\")\n    dep_client.restart_deployment(DEPLOYMENT)\n    print(\"Rolling restart initiated.\")\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"examples/manage-deployments/#running-the-script","title":"Running the Script","text":"<pre><code>export KUBECONFIG=~/.kube/config\nexport KUBE_CONTEXT=my-eks-cluster   # optional, uses current context by default\n\npython manage_deployments.py\n</code></pre>"},{"location":"examples/manage-deployments/#cli-equivalents","title":"CLI Equivalents","text":"<pre><code># Check pods\ndevops eks list-pods --namespace production --selector app=my-api\n\n# Stream logs from a specific pod\ndevops eks get-pod-logs my-api-abc123 --namespace production --tail 100\n\n# Stream previous container logs\ndevops eks get-pod-logs my-api-abc123 --namespace production --previous\n\n# Check deployment status\ndevops eks list-deployments --namespace production\n\n# Scale the deployment\ndevops eks scale-deployment my-api 5 --namespace production\n</code></pre>"},{"location":"examples/manage-deployments/#tips","title":"Tips","text":"<ul> <li><code>restart_deployment</code> patches a pod template annotation \u2014 Kubernetes rolls pods one at a time while keeping others available.</li> <li>Use <code>delete_pod</code> on a specific pod to force an immediate restart of that pod (the Deployment controller will recreate it).</li> <li>Combine <code>--selector</code> filtering with <code>list_pods</code> to target only the pods belonging to a specific deployment.</li> </ul>"},{"location":"examples/query-logs/","title":"Example: Query Datadog Logs &amp; Metrics","text":"<p>This example shows how to search logs for errors, aggregate them by service, and correlate with CPU metrics.</p>"},{"location":"examples/query-logs/#prerequisites","title":"Prerequisites","text":"<pre><code>export DD_API_KEY=your_api_key\nexport DD_APP_KEY=your_application_key\n</code></pre>"},{"location":"examples/query-logs/#search-logs-for-errors","title":"Search Logs for Errors","text":"<pre><code>\"\"\"query_logs.py \u2014 Search and aggregate Datadog logs, then query related metrics.\"\"\"\n\nfrom datetime import datetime, timedelta, timezone\nfrom devops_framework.datadog.logs import LogsClient\nfrom devops_framework.datadog.metrics import MetricsClient\n\nSERVICE = \"my-api\"\nHOURS = 4\n\nnow = datetime.now(timezone.utc)\nfrom_time = now - timedelta(hours=HOURS)\n\n\ndef search_errors(logs_client: LogsClient) -&gt; list[dict]:\n    \"\"\"Return error logs from the last N hours.\"\"\"\n    logs = logs_client.search_logs(\n        query=f\"service:{SERVICE} status:error\",\n        from_time=from_time,\n        to_time=now,\n        limit=100,\n    )\n    print(f\"\\nFound {len(logs)} error log(s) in the last {HOURS} hours:\\n\")\n    for log in logs[:10]:  # print first 10\n        attrs = log.get(\"attributes\", {})\n        ts = attrs.get(\"timestamp\", \"\")\n        msg = attrs.get(\"message\", \"\")\n        host = attrs.get(\"host\", \"\")\n        print(f\"  [{ts}] {host}: {msg[:120]}\")\n    return logs\n\n\ndef aggregate_by_status(logs_client: LogsClient) -&gt; None:\n    \"\"\"Print error count grouped by HTTP status code.\"\"\"\n    buckets = logs_client.aggregate_logs(\n        query=f\"service:{SERVICE}\",\n        from_time=from_time,\n        to_time=now,\n        group_by_fields=[\"http.status_code\"],\n    )\n    print(f\"\\nLog counts by HTTP status for {SERVICE}:\")\n    for bucket in buckets:\n        by = bucket.get(\"by\", {})\n        computes = bucket.get(\"computes\", {})\n        print(f\"  status={by.get('http.status_code', '?')}  count={computes.get('c0', 0)}\")\n\n\ndef query_cpu(metrics_client: MetricsClient) -&gt; None:\n    \"\"\"Print CPU utilization statistics for the same window.\"\"\"\n    result = metrics_client.query_metrics(\n        query=f\"avg:system.cpu.user{{service:{SERVICE}}}\",\n        from_time=from_time,\n        to_time=now,\n    )\n    series = result.get(\"series\", [])\n    if not series:\n        print(\"\\nNo CPU metrics found.\")\n        return\n\n    print(f\"\\nCPU utilization for {SERVICE} over the last {HOURS} hours:\")\n    for s in series:\n        points = s.get(\"pointlist\", [])\n        if not points:\n            continue\n        values = [v for _, v in points if v is not None]\n        if values:\n            print(\n                f\"  scope={s.get('scope', '?')}  \"\n                f\"min={min(values):.1f}%  \"\n                f\"max={max(values):.1f}%  \"\n                f\"avg={sum(values)/len(values):.1f}%\"\n            )\n\n\ndef main() -&gt; None:\n    logs_client = LogsClient()\n    metrics_client = MetricsClient()\n\n    search_errors(logs_client)\n    aggregate_by_status(logs_client)\n    query_cpu(metrics_client)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"examples/query-logs/#running-the-script","title":"Running the Script","text":"<pre><code>python query_logs.py\n</code></pre>"},{"location":"examples/query-logs/#cli-equivalents","title":"CLI Equivalents","text":"<pre><code># Search error logs\ndevops datadog search-logs --query \"service:my-api status:error\" --hours 4 --limit 100\n\n# List active metrics\ndevops datadog list-metrics --hours 4\n\n# Query CPU metrics\ndevops datadog query-metrics --query \"avg:system.cpu.user{service:my-api}\" --hours 4\n</code></pre>"},{"location":"examples/query-logs/#tips","title":"Tips","text":"<ul> <li>Use <code>aggregate_logs</code> to count errors by facets like <code>service</code>, <code>status</code>, <code>http.status_code</code>, or <code>host</code> \u2014 much faster than iterating individual logs.</li> <li>The <code>query_metrics</code> response's <code>series[].pointlist</code> contains <code>[epoch_ms, value]</code> pairs.</li> <li>Datadog timestamps in log <code>attributes.timestamp</code> are ISO 8601 strings; parse them with <code>datetime.fromisoformat()</code> if you need arithmetic.</li> </ul>"},{"location":"examples/troubleshoot-ec2/","title":"Example: Troubleshoot EC2 Instances","text":"<p>This example shows how to find unhealthy instances, inspect their status, and restart them.</p>"},{"location":"examples/troubleshoot-ec2/#scenario","title":"Scenario","text":"<p>You have a fleet of EC2 instances and want to:</p> <ol> <li>List all instances with a failed status check</li> <li>Inspect each unhealthy instance</li> <li>Stop and restart instances that have failed</li> </ol>"},{"location":"examples/troubleshoot-ec2/#script","title":"Script","text":"<pre><code>\"\"\"troubleshoot_ec2.py \u2014 Find and restart EC2 instances with failed status checks.\"\"\"\n\nfrom devops_framework.aws.ec2 import EC2Client\nfrom devops_framework.core.exceptions import AWSAPIError, ResourceNotFoundError\n\nREGION = \"us-east-1\"\n\n\ndef find_unhealthy_instances(client: EC2Client) -&gt; list[dict]:\n    \"\"\"Return instances with a failed instance or system status check.\"\"\"\n    all_instances = client.list_running_instances()\n    unhealthy = []\n\n    for inst in all_instances:\n        instance_id = inst[\"InstanceId\"]\n        try:\n            status = client.get_instance_status(instance_id)\n        except ResourceNotFoundError:\n            continue\n\n        instance_check = status.get(\"InstanceStatus\", {}).get(\"Status\", \"ok\")\n        system_check = status.get(\"SystemStatus\", {}).get(\"Status\", \"ok\")\n\n        if instance_check != \"ok\" or system_check != \"ok\":\n            unhealthy.append({\n                \"instance_id\": instance_id,\n                \"instance_check\": instance_check,\n                \"system_check\": system_check,\n                \"name\": next(\n                    (t[\"Value\"] for t in inst.get(\"Tags\", []) if t[\"Key\"] == \"Name\"),\n                    \"(no name)\",\n                ),\n            })\n\n    return unhealthy\n\n\ndef restart_instance(client: EC2Client, instance_id: str) -&gt; None:\n    \"\"\"Stop then start an EC2 instance.\"\"\"\n    print(f\"  Stopping {instance_id}...\")\n    try:\n        client.stop_instance(instance_id)\n        print(f\"  Starting {instance_id}...\")\n        client.start_instance(instance_id)\n        print(f\"  {instance_id} restarted successfully.\")\n    except AWSAPIError as exc:\n        print(f\"  Failed to restart {instance_id}: {exc}\")\n\n\ndef main() -&gt; None:\n    client = EC2Client(region=REGION)\n    print(f\"Scanning instances in {REGION}...\")\n\n    unhealthy = find_unhealthy_instances(client)\n\n    if not unhealthy:\n        print(\"All instances are healthy.\")\n        return\n\n    print(f\"\\nFound {len(unhealthy)} unhealthy instance(s):\\n\")\n    for info in unhealthy:\n        print(\n            f\"  {info['instance_id']} ({info['name']}) \u2014 \"\n            f\"instance={info['instance_check']}, system={info['system_check']}\"\n        )\n\n    print(\"\\nRestarting unhealthy instances...\")\n    for info in unhealthy:\n        restart_instance(client, info[\"instance_id\"])\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"examples/troubleshoot-ec2/#running-the-script","title":"Running the Script","text":"<pre><code># Set AWS credentials\nexport AWS_DEFAULT_REGION=us-east-1\nexport AWS_PROFILE=my-profile   # or use AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY\n\npython troubleshoot_ec2.py\n</code></pre>"},{"location":"examples/troubleshoot-ec2/#using-the-cli-instead","title":"Using the CLI Instead","text":"<pre><code># Check for instances with non-running states\ndevops aws list-instances --region us-east-1\n\n# Inspect a specific instance\ndevops aws describe-instance i-0abc123def456 --region us-east-1\n</code></pre>"},{"location":"examples/troubleshoot-ec2/#tips","title":"Tips","text":"<ul> <li><code>get_instance_status</code> checks both instance status (OS-level) and system status (hardware-level).</li> <li>Status values are <code>ok</code>, <code>impaired</code>, <code>insufficient-data</code>, <code>not-applicable</code>, or <code>initializing</code>.</li> <li>Always check that <code>instance_check != \"ok\"</code> or <code>system_check != \"ok\"</code> \u2014 either check failing indicates a problem.</li> </ul>"}]}